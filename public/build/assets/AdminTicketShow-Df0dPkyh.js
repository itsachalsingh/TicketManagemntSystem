import{u as N,a as f,j as e,H as w,L as _}from"./app-CmKVqBY_.js";import{A as D}from"./AdminLayout-547HgU7n.js";import"./Dropdown-Umnt_gh2.js";import"./transition-DLr6TU6a.js";const $=({ticket:a,comments:d,users:n=[]})=>{const{auth:c}=N().props,{data:l,setData:i,post:o,patch:g,processing:x,reset:u,errors:m}=f({message:"",ticket_id:a.id,status:a.status||"open",assigned_user_id:a.assigned_user?.id||""}),h=s=>{s.preventDefault(),o(route("comments.store"),{onSuccess:()=>u("message")})},p=()=>{g(route("admin.tickets.update-status",a.id),{preserveScroll:!0})},b=s=>{switch(s){case"high":return"bg-red-100 text-red-700";case"medium":return"bg-yellow-100 text-yellow-800";case"low":return"bg-green-100 text-green-700";default:return"bg-gray-100 text-gray-700"}},j=s=>s.kind==="image"||s.mime_type.startsWith("image/"),y=s=>s.kind==="video"||s.mime_type.startsWith("video/"),v=s=>s?.startsWith("/")?s:`/${s}`;return e.jsxs(D,{children:[e.jsx(w,{title:`Ticket: ${a.title}`}),e.jsxs("div",{className:"p-6 max-w-7xl mx-auto space-y-8",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx(_,{href:route("admin.tickets.index"),className:"text-sm text-indigo-600 hover:underline",children:"← Back to ticket list"}),e.jsx("h1",{className:"text-lg font-semibold text-gray-800",children:"Ticket Details"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-8",children:[e.jsxs("div",{className:"md:col-span-2 space-y-8",children:[e.jsxs("div",{className:"bg-gradient-to-br from-white to-gray-50 border border-gray-200 shadow-md rounded-2xl p-8 space-y-8",children:[e.jsx(r,{label:"Title",value:a.subject,isFull:!0}),e.jsx(r,{label:"Description",value:a.description,isFull:!0,isPre:!0})]}),!!a.attachments?.length&&e.jsxs("div",{className:"bg-white border border-gray-200 shadow rounded-2xl p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Attachments"}),e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-4 gap-4",children:a.attachments.map(s=>{const t=v(s.path);return j(s)?e.jsxs("a",{href:t,target:"_blank",rel:"noreferrer",className:"block group",title:s.original_name,children:[e.jsx("div",{className:"aspect-square overflow-hidden rounded-lg border bg-gray-50",children:e.jsx("img",{src:t,alt:s.original_name,className:"w-full h-full object-cover group-hover:opacity-90 transition",loading:"lazy"})}),e.jsx("div",{className:"mt-1 text-xs text-gray-600 truncate",children:s.original_name})]},s.id):y(s)?e.jsxs("div",{className:"block",children:[e.jsx("div",{className:"aspect-square overflow-hidden rounded-lg border bg-black/5",children:e.jsx("video",{src:t,controls:!0,className:"w-full h-full object-cover"})}),e.jsx("a",{href:t,download:!0,className:"mt-1 inline-block text-xs text-indigo-600 hover:underline",children:"Download video"})]},s.id):e.jsxs("a",{href:t,download:!0,className:"flex items-center gap-2 p-3 rounded-lg border hover:bg-gray-50",title:s.original_name,children:[e.jsx("span",{className:"text-sm text-gray-700 truncate",children:s.original_name}),e.jsx("span",{className:"ml-auto text-xs text-gray-500",children:s.mime_type})]},s.id)})})]})]}),e.jsx("div",{children:e.jsxs("div",{className:"bg-white border border-gray-200 shadow rounded-2xl p-8 flex flex-col justify-between h-full space-y-4",children:[e.jsx(r,{label:"Ticket ID",value:a.ticket_number}),e.jsx(r,{label:"Category",value:a.category?a.sub_category?`${a.category.name} - ${a.sub_category.name}`:a.category.name:"—"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-500 text-sm",children:"Priority"}),e.jsx("span",{className:`inline-block px-3 py-1 rounded-full text-xs font-bold tracking-wide ${b(a.priority)}`,children:a.priority.toUpperCase()})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-gray-500 text-sm",children:"Status"}),e.jsxs("select",{className:"mt-1 w-full border border-gray-300 rounded px-2 py-1 text-sm",value:l.status,onChange:s=>i("status",s.target.value),children:[e.jsx("option",{value:"open",children:"Open"}),e.jsx("option",{value:"responded",children:"Responded"}),e.jsx("option",{value:"in_progress",children:"In Progress"}),e.jsx("option",{value:"resolved",children:"Resolved"}),e.jsx("option",{value:"closed",children:"Closed"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-gray-500 text-sm",children:"Assign To"}),e.jsxs("select",{className:"mt-1 w-full border border-gray-300 rounded px-2 py-1 text-sm",value:l.assigned_user_id,onChange:s=>i("assigned_user_id",s.target.value),children:[e.jsx("option",{value:"",children:"-- Unassigned --"}),Array.isArray(n)&&n.map(s=>e.jsx("option",{value:s.id,children:s.name},s.id))]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(r,{label:"Created Date",value:new Date(a.created_at).toLocaleDateString()}),e.jsx(r,{label:"Closed Date",value:a.closed_at?new Date(a.closed_at).toLocaleDateString():"—"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(r,{label:"Created By",value:a.user?.name||"—"}),e.jsx(r,{label:"Assigned To",value:a.assigned_to?.name||"Unassigned"})]}),e.jsx("button",{className:"bg-indigo-600 text-white text-sm px-4 py-2 rounded hover:bg-indigo-700 transition mt-4",onClick:p,disabled:x,children:"Save Changes"})]})})]}),e.jsxs("div",{className:"bg-white border border-gray-200 shadow rounded-2xl p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Discussion"}),d.length>0?e.jsx("div",{className:"space-y-4",children:d.map((s,t)=>e.jsxs("div",{className:`border border-gray-200 rounded p-4 ${t%2===0?"bg-gray-50":"bg-indigo-50"}`,children:[e.jsx("div",{className:"text-sm font-medium text-gray-800",children:s.user.name}),e.jsx("div",{className:"text-sm text-gray-700 mt-1",children:s.message}),e.jsx("div",{className:"text-xs text-gray-400 mt-1",children:new Date(s.created_at).toLocaleString()})]},s.id))}):e.jsx("p",{className:"text-sm text-gray-500 mb-4",children:"No comments yet."}),e.jsxs("form",{onSubmit:h,className:"mt-6 space-y-2",children:[e.jsx("textarea",{value:l.message,onChange:s=>i("message",s.target.value),className:"w-full border border-gray-300 rounded px-4 py-2 text-sm",placeholder:"Write a reply..."}),m.message&&e.jsx("div",{className:"text-red-500 text-xs",children:m.message}),e.jsx("button",{type:"submit",disabled:x,className:"bg-indigo-600 text-white px-4 py-2 text-sm rounded hover:bg-indigo-700 disabled:opacity-50",children:"Post Comment"})]})]})]})]})};function r({label:a,value:d,color:n="text-gray-800",isFull:c=!1,isPre:l=!1}){const i=c?"md:col-span-2":"",o=`text-base ${n}`;return e.jsxs("div",{className:i,children:[e.jsx("p",{className:"text-sm text-gray-500",children:a}),e.jsx("p",{className:o+(l?" whitespace-pre-wrap":""),children:d})]})}export{$ as default};
